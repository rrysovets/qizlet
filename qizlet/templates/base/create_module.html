
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Создать модуль</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Создать модуль</h1>
    <form method="post">
        {% csrf_token %}
        <label for="id_title">Название модуля:</label>
        <input type="text" name="title" id="id_title" required><br><br>

        <div id="words-container">
            <div class="word-pair">
                <input type="text" name="word" placeholder="Слово на русском" required>
                <input type="text" name="translation" placeholder="Перевод" required>
                <button type="button" class="remove-word" style="display: none;">Удалить</button>
            </div>
        </div>
        
        <button type="button" id="add-word">Добавить слово</button>
        
        <input type="hidden" name="words" id="words-json">
        <br><br>
        <button type="submit">Сохранить</button>
    </form>

    <script>
        $(document).ready(function () {
            $("#add-word").click(function () {
                let newPair = $('<div class="word-pair">' +
                    '<input type="text" name="word" placeholder="Слово на русском" required>' +
                    '<input type="text" name="translation" placeholder="Перевод" required>' +
                    '<button type="button" class="remove-word">Удалить</button>' +
                    '</div>');
                $("#words-container").append(newPair);
            });
    
            $(document).on("click", ".remove-word", function () {
                $(this).parent().remove();
            });
    
            $("form").submit(function (event) {
                let words = {};
                $(".word-pair").each(function () {
                    let word = $(this).find("input[name='word']").val().trim();
                    let translation = $(this).find("input[name='translation']").val().trim();
                    if (word && translation) {
                        words[word] = translation;
                    }
                });
    
                let wordsJson = JSON.stringify(words);
                $("#words-json").val(wordsJson);
    
                console.log("Отправляем JSON:", wordsJson);  // Проверяем данные перед отправкой
    
                if (Object.keys(words).length === 0) {
                    alert("Добавьте хотя бы одну пару слово-перевод!");
                    event.preventDefault(); // Отмена отправки формы, если пустой JSON
                }
            });
        });
    </script>
    
</body>
</html>